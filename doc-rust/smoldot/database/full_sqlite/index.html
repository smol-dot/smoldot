<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Filesystem-backed database containing all the information about a chain."><title>smoldot::database::full_sqlite - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-84e720fa.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.89.0 (29483883e 2025-08-04)" data-channel="1.89.0" data-search-js="search-92309212.js" data-settings-js="settings-5514c975.js" ><script src="../../../static.files/storage-4e99c027.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-fd3af306.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../smoldot/index.html">smoldot</a><span class="version">0.19.4</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module full_<wbr>sqlite</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#usage" title="Usage">Usage</a></li><li><a href="#about-errors-handling" title="About errors handling">About errors handling</a></li><li><a href="#schema" title="Schema">Schema</a></li><li><a href="#about-blocking-behavior" title="About blocking behavior">About blocking behavior</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In smoldot::<wbr>database</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">database</a></div><h1>Module <span>full_sqlite</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/smoldot/database/full_sqlite.rs.html#18-1842">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Filesystem-backed database containing all the information about a chain.</p>
<p>This module handles the persistent storage of the chain on disk.</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2>
<p>Use the <a href="fn.open.html" title="fn smoldot::database::full_sqlite::open"><code>open()</code></a> function to create a new database or open an existing one. <a href="fn.open.html" title="fn smoldot::database::full_sqlite::open"><code>open()</code></a>
returns a <a href="enum.DatabaseOpen.html" title="enum smoldot::database::full_sqlite::DatabaseOpen"><code>DatabaseOpen</code></a> enum. This enum will contain either a <a href="struct.SqliteFullDatabase.html" title="struct smoldot::database::full_sqlite::SqliteFullDatabase"><code>SqliteFullDatabase</code></a> object,
representing an access to the database, or a <a href="struct.DatabaseEmpty.html" title="struct smoldot::database::full_sqlite::DatabaseEmpty"><code>DatabaseEmpty</code></a> if the database didn’t exist or
is empty. If that is the case, use <a href="struct.DatabaseEmpty.html#method.initialize" title="method smoldot::database::full_sqlite::DatabaseEmpty::initialize"><code>DatabaseEmpty::initialize</code></a> in order to populate it and
obtain a <a href="struct.SqliteFullDatabase.html" title="struct smoldot::database::full_sqlite::SqliteFullDatabase"><code>SqliteFullDatabase</code></a>.</p>
<p>Use <a href="struct.SqliteFullDatabase.html#method.insert" title="method smoldot::database::full_sqlite::SqliteFullDatabase::insert"><code>SqliteFullDatabase::insert</code></a> to insert a new block in the database. The block is assumed
to have been successfully verified prior to insertion. An error is returned if this block is
already in the database or isn’t a descendant or ancestor of the latest finalized block.</p>
<p>Use <a href="struct.SqliteFullDatabase.html#method.set_finalized" title="method smoldot::database::full_sqlite::SqliteFullDatabase::set_finalized"><code>SqliteFullDatabase::set_finalized</code></a> to mark a block already in the database as finalized.
Any block that isn’t an ancestor or descendant will be removed. Reverting finalization is
not supported.</p>
<p>In order to minimize disk usage, it is not possible to efficiently retrieve the storage items
of blocks that are ancestors of the finalized block. When a block is finalized, the storage of
its ancestors is lost, and the only way to reconstruct it is to execute all blocks starting
from the genesis to the desired one.</p>
<h2 id="about-errors-handling"><a class="doc-anchor" href="#about-errors-handling">§</a>About errors handling</h2>
<p>Most of the functions and methods in this module return a <code>Result</code> containing notably an
<a href="enum.CorruptedError.html" title="enum smoldot::database::full_sqlite::CorruptedError"><code>CorruptedError</code></a>. This kind of errors can happen if the operating system returns an error
when accessing the file system, or if the database has been corrupted, for example by the user
manually modifying it.</p>
<p>There isn’t much that can be done to properly handle an <a href="enum.CorruptedError.html" title="enum smoldot::database::full_sqlite::CorruptedError"><code>CorruptedError</code></a>. The only
reasonable solutions are either to stop the program, or to delete the entire database and
recreate it.</p>
<h2 id="schema"><a class="doc-anchor" href="#schema">§</a>Schema</h2>
<p>The SQL schema of the database, with explanatory comments, can be found in <code>open.rs</code>.</p>
<h2 id="about-blocking-behavior"><a class="doc-anchor" href="#about-blocking-behavior">§</a>About blocking behavior</h2>
<p>This implementation uses the SQLite library, which isn’t Rust-asynchronous-compatible. Many
functions will, with the help of the operating system, put the current thread to sleep while
waiting for an I/O operation to finish. In the context of asynchronous Rust, this is
undesirable.</p>
<p>For this reason, you are encouraged to isolate the database in its own threads and never
access it directly from an asynchronous context.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.Config.html" title="struct smoldot::database::full_sqlite::Config">Config</a></dt><dd>Configuration for the database.</dd><dt><a class="struct" href="struct.DatabaseEmpty.html" title="struct smoldot::database::full_sqlite::DatabaseEmpty">Database<wbr>Empty</a></dt><dd>An open database. Holds file descriptors.</dd><dt><a class="struct" href="struct.InsertTrieNode.html" title="struct smoldot::database::full_sqlite::InsertTrieNode">Insert<wbr>Trie<wbr>Node</a></dt><dt><a class="struct" href="struct.InternalError.html" title="struct smoldot::database::full_sqlite::InternalError">Internal<wbr>Error</a></dt><dd>Low-level database error, such as an error while accessing the file system.</dd><dt><a class="struct" href="struct.MissingTrieNode.html" title="struct smoldot::database::full_sqlite::MissingTrieNode">Missing<wbr>Trie<wbr>Node</a></dt><dd>See <a href="struct.SqliteFullDatabase.html#method.finalized_and_above_missing_trie_nodes_unordered" title="method smoldot::database::full_sqlite::SqliteFullDatabase::finalized_and_above_missing_trie_nodes_unordered"><code>SqliteFullDatabase::finalized_and_above_missing_trie_nodes_unordered</code></a>.</dd><dt><a class="struct" href="struct.MissingTrieNodeBlock.html" title="struct smoldot::database::full_sqlite::MissingTrieNodeBlock">Missing<wbr>Trie<wbr>Node<wbr>Block</a></dt><dd>See <a href="struct.MissingTrieNode.html#structfield.blocks" title="field smoldot::database::full_sqlite::MissingTrieNode::blocks"><code>MissingTrieNode::blocks</code></a>.</dd><dt><a class="struct" href="struct.SqliteFullDatabase.html" title="struct smoldot::database::full_sqlite::SqliteFullDatabase">Sqlite<wbr>Full<wbr>Database</a></dt><dd>An open database. Holds file descriptors.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.ConfigTy.html" title="enum smoldot::database::full_sqlite::ConfigTy">Config<wbr>Ty</a></dt><dd>Type of database.</dd><dt><a class="enum" href="enum.CorruptedError.html" title="enum smoldot::database::full_sqlite::CorruptedError">Corrupted<wbr>Error</a></dt><dd>Error in the content of the database.</dd><dt><a class="enum" href="enum.DatabaseOpen.html" title="enum smoldot::database::full_sqlite::DatabaseOpen">Database<wbr>Open</a></dt><dd>Either existing database or database prototype.</dd><dt><a class="enum" href="enum.InsertError.html" title="enum smoldot::database::full_sqlite::InsertError">Insert<wbr>Error</a></dt><dd>Error while calling <a href="struct.SqliteFullDatabase.html#method.insert" title="method smoldot::database::full_sqlite::SqliteFullDatabase::insert"><code>SqliteFullDatabase::insert</code></a>.</dd><dt><a class="enum" href="enum.InsertTrieNodeStorageValue.html" title="enum smoldot::database::full_sqlite::InsertTrieNodeStorageValue">Insert<wbr>Trie<wbr>Node<wbr>Storage<wbr>Value</a></dt><dt><a class="enum" href="enum.SetFinalizedError.html" title="enum smoldot::database::full_sqlite::SetFinalizedError">SetFinalized<wbr>Error</a></dt><dd>Error while calling <a href="struct.SqliteFullDatabase.html#method.set_finalized" title="method smoldot::database::full_sqlite::SqliteFullDatabase::set_finalized"><code>SqliteFullDatabase::set_finalized</code></a>.</dd><dt><a class="enum" href="enum.StorageAccessError.html" title="enum smoldot::database::full_sqlite::StorageAccessError">Storage<wbr>Access<wbr>Error</a></dt><dd>Error while accessing the storage of the finalized block.</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.open.html" title="fn smoldot::database::full_sqlite::open">open</a></dt><dd>Opens the database using the given <a href="struct.Config.html" title="struct smoldot::database::full_sqlite::Config"><code>Config</code></a>.</dd><dt><a class="fn" href="fn.sqlite_version.html" title="fn smoldot::database::full_sqlite::sqlite_version">sqlite_<wbr>version</a></dt><dd>Returns an opaque string representing the version number of the SQLite library this binary
is using.</dd></dl></section></div></main></body></html>