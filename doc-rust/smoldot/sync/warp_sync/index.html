<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Warp syncing."><title>smoldot::sync::warp_sync - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-84e720fa.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.89.0 (29483883e 2025-08-04)" data-channel="1.89.0" data-search-js="search-92309212.js" data-settings-js="settings-5514c975.js" ><script src="../../../static.files/storage-4e99c027.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-fd3af306.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../smoldot/index.html">smoldot</a><span class="version">0.19.4</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module warp_<wbr>sync</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#long-range-attack-vulnerability" title="Long range attack vulnerability">Long range attack vulnerability</a></li><li><a href="#overview" title="Overview">Overview</a></li><li><a href="#usage" title="Usage">Usage</a></li></ul><h3><a href="#reexports">Module Items</a></h3><ul class="block"><li><a href="#reexports" title="Re-exports">Re-exports</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In smoldot::<wbr>sync</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">sync</a></div><h1>Module <span>warp_sync</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/smoldot/sync/warp_sync.rs.html#18-2358">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Warp syncing.</p>
<p>Warp syncing makes it possible to very quickly reach the currently finalized block of a chain.
No attempt is made at verifying blocks. The algorithm assumes that the currently finalized
block is valid, as the chain is likely bricked if this is not the case.</p>
<h2 id="long-range-attack-vulnerability"><a class="doc-anchor" href="#long-range-attack-vulnerability">§</a>Long range attack vulnerability</h2>
<p>Warp syncing is particularly vulnerable to what is called long range attacks.</p>
<p>The authorities allowed to finalize blocks can generate multiple proofs of finality for
multiple different blocks of the same height. In other words, they can finalize more than one
chain at a time.</p>
<p>Finalizing multiple chains at the same time is called an equivocation. Client implementations
detect equivocations and report them to the runtime. While this is out of scope of the client,
the runtime then typically provides a mechanism that punishes the validators that have
equivocated.
However, this defense mechanism is flawed in case when a long time passes between the
multiple finality proofs generated by the same validators. Clients cannot hold an unlimited
amount of information in memory, so they might not detect the equivocation, and even if it is
detected, the punishment might not be enforceable because validators have moved all their
funds.</p>
<p>In other words, it is possible for two thirds of the validators that were active at a certain
past block N to collude and decide to finalize a different block N, even when N has been
finalized for the first time several weeks or months in the past. When a client then warp
syncs, it can be tricked to consider this alternative block N as the finalized one.</p>
<p>There is no fool-proof defense against this attack. However, consider the extremely high
investment and high risk for the malicious validators, and the difficulty of pulling off this
attack, it is extremely unlikely to happen in reality.
The aforementioned punishment system is the only defense against this attack, and in order to
be effective, the starting point of the warp syncing shouldn’t be too far in the past. How
far exactly depends on the logic of the runtime of the chain.</p>
<h2 id="overview"><a class="doc-anchor" href="#overview">§</a>Overview</h2>
<p>The warp syncing algorithm works only if the chain uses Grandpa for its finality.
It consists in the following steps:</p>
<ul>
<li>Downloading a warp sync proof from a source. This proof contains a list of <em>fragments</em>. Each
fragment represents a change in the list of Grandpa authorities, and a list of signatures of
the previous authorities that certify that this change is correct.</li>
<li>Verifying the fragments. Each fragment that is successfully verified progresses towards
the head of the chain. Even if one fragment is invalid, all the previously-verified
fragments can still be kept, and the warp syncing can resume from there.</li>
<li>Downloading from a source the runtime code of the final block of the proof.</li>
<li>Performing some runtime calls in order to obtain the current consensus-related parameters
of the chain. This might require obtaining some storage items, in which case they must also
be downloaded from a source.</li>
</ul>
<p>At the end of the syncing, a <a href="../../chain/chain_information/struct.ValidChainInformation.html" title="struct smoldot::chain::chain_information::ValidChainInformation"><code>ValidChainInformation</code></a> corresponding to the head of the chain
is yielded.</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2>
<p>Use the <a href="fn.start_warp_sync.html" title="fn smoldot::sync::warp_sync::start_warp_sync"><code>start_warp_sync()</code></a> function to start a Grandpa warp syncing state machine.</p>
<p>At any given moment, this state machine holds a list of <em>sources</em> that it might use to
download the warp sync proof or the runtime code. Sources must be added and removed by the API
user by calling one of the various <code>add_source</code> and <code>remove_source</code> functions.</p>
<p>Sources are identified through a <a href="struct.SourceId.html" title="struct smoldot::sync::warp_sync::SourceId"><code>SourceId</code></a>. Each source has an opaque so-called “user data”
of type <code>TSrc</code> associated to it. The content of this “user data” is at the discretion of the
API user.</p>
<p>Similarly, at any given moment, this state machine holds a list of requests that concern these
sources. Use <a href="struct.WarpSync.html#method.desired_requests" title="method smoldot::sync::warp_sync::WarpSync::desired_requests"><code>WarpSync::desired_requests</code></a> to determine which requests will be useful to the
progress of the warp syncing, then use <a href="struct.WarpSync.html#method.add_request" title="method smoldot::sync::warp_sync::WarpSync::add_request"><code>WarpSync::add_request</code></a> to update the state machine
with a newly-started request.</p>
<p>Use <a href="struct.WarpSync.html#method.process_one" title="method smoldot::sync::warp_sync::WarpSync::process_one"><code>WarpSync::process_one</code></a> in order to run verifications of the payloads that have
previously been downloaded.</p>
</div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">§</a></h2><dl class="item-table reexports"><dt id="reexport.Nibble"><code>pub use trie::<a class="struct" href="../../trie/struct.Nibble.html" title="struct smoldot::trie::Nibble">Nibble</a>;</code></dt></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.BuildChainInformation.html" title="struct smoldot::sync::warp_sync::BuildChainInformation">Build<wbr>Chain<wbr>Information</a></dt><dd>Ready to verify the parameters of the chain against the finalized block.</dd><dt><a class="struct" href="struct.BuildRuntime.html" title="struct smoldot::sync::warp_sync::BuildRuntime">Build<wbr>Runtime</a></dt><dd>Ready to build the runtime of the finalized chain.</dd><dt><a class="struct" href="struct.Config.html" title="struct smoldot::sync::warp_sync::Config">Config</a></dt><dd>The configuration for <a href="fn.start_warp_sync.html" title="fn smoldot::sync::warp_sync::start_warp_sync"><code>start_warp_sync()</code></a>.</dd><dt><a class="struct" href="struct.ConfigCodeTrieNodeHint.html" title="struct smoldot::sync::warp_sync::ConfigCodeTrieNodeHint">Config<wbr>Code<wbr>Trie<wbr>Node<wbr>Hint</a></dt><dd>See <a href="struct.Config.html#structfield.code_trie_node_hint" title="field smoldot::sync::warp_sync::Config::code_trie_node_hint"><code>Config::code_trie_node_hint</code></a>.</dd><dt><a class="struct" href="struct.RequestId.html" title="struct smoldot::sync::warp_sync::RequestId">Request<wbr>Id</a></dt><dd>Identifier for a request in the warp sync state machine.</dd><dt><a class="struct" href="struct.RuntimeInformation.html" title="struct smoldot::sync::warp_sync::RuntimeInformation">Runtime<wbr>Information</a></dt><dt><a class="struct" href="struct.SourceId.html" title="struct smoldot::sync::warp_sync::SourceId">Source<wbr>Id</a></dt><dd>Identifier for a source in the <a href="struct.WarpSync.html" title="struct smoldot::sync::warp_sync::WarpSync"><code>WarpSync</code></a>.</dd><dt><a class="struct" href="struct.SourceMisbehavior.html" title="struct smoldot::sync::warp_sync::SourceMisbehavior">Source<wbr>Misbehavior</a></dt><dd>Problem encountered during a call to <a href="struct.BuildRuntime.html#method.build" title="method smoldot::sync::warp_sync::BuildRuntime::build"><code>BuildRuntime::build</code></a> or
<a href="struct.BuildChainInformation.html#method.build" title="method smoldot::sync::warp_sync::BuildChainInformation::build"><code>BuildChainInformation::build</code></a> that can be attributed to the source sending invalid data.</dd><dt><a class="struct" href="struct.VerifyWarpSyncFragment.html" title="struct smoldot::sync::warp_sync::VerifyWarpSyncFragment">Verify<wbr>Warp<wbr>Sync<wbr>Fragment</a></dt><dd>Ready to verify a warp sync fragment.</dd><dt><a class="struct" href="struct.WarpSync.html" title="struct smoldot::sync::warp_sync::WarpSync">Warp<wbr>Sync</a></dt><dd>Warp syncing process state machine.</dd><dt><a class="struct" href="struct.WarpSyncFragment.html" title="struct smoldot::sync::warp_sync::WarpSyncFragment">Warp<wbr>Sync<wbr>Fragment</a></dt><dd>Fragment to be verified.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.BuildChainInformationError.html" title="enum smoldot::sync::warp_sync::BuildChainInformationError">Build<wbr>Chain<wbr>Information<wbr>Error</a></dt><dd>Problem encountered during a call to <a href="struct.BuildChainInformation.html#method.build" title="method smoldot::sync::warp_sync::BuildChainInformation::build"><code>BuildChainInformation::build</code></a>.</dd><dt><a class="enum" href="enum.BuildRuntimeError.html" title="enum smoldot::sync::warp_sync::BuildRuntimeError">Build<wbr>Runtime<wbr>Error</a></dt><dd>Problem encountered during a call to <a href="struct.BuildRuntime.html#method.build" title="method smoldot::sync::warp_sync::BuildRuntime::build"><code>BuildRuntime::build</code></a>.</dd><dt><a class="enum" href="enum.DesiredRequest.html" title="enum smoldot::sync::warp_sync::DesiredRequest">Desired<wbr>Request</a></dt><dd>Information about a request that the warp sync state machine would like to start.</dd><dt><a class="enum" href="enum.ProcessOne.html" title="enum smoldot::sync::warp_sync::ProcessOne">Process<wbr>One</a></dt><dd>Return value of <a href="struct.WarpSync.html#method.process_one" title="method smoldot::sync::warp_sync::WarpSync::process_one"><code>WarpSync::process_one</code></a>.</dd><dt><a class="enum" href="enum.RequestDetail.html" title="enum smoldot::sync::warp_sync::RequestDetail">Request<wbr>Detail</a></dt><dd>Information about a request to add to the state machine.</dd><dt><a class="enum" href="enum.SourceMisbehaviorTy.html" title="enum smoldot::sync::warp_sync::SourceMisbehaviorTy">Source<wbr>Misbehavior<wbr>Ty</a></dt><dd>See <a href="struct.SourceMisbehavior.html#structfield.error" title="field smoldot::sync::warp_sync::SourceMisbehavior::error"><code>SourceMisbehavior::error</code></a>.</dd><dt><a class="enum" href="enum.Status.html" title="enum smoldot::sync::warp_sync::Status">Status</a></dt><dd>See <a href="struct.WarpSync.html#method.status" title="method smoldot::sync::warp_sync::WarpSync::status"><code>WarpSync::status</code></a>.</dd><dt><a class="enum" href="enum.VerifyFragmentError.html" title="enum smoldot::sync::warp_sync::VerifyFragmentError">Verify<wbr>Fragment<wbr>Error</a></dt><dd>Error potentially returned by <a href="struct.VerifyWarpSyncFragment.html#method.verify" title="method smoldot::sync::warp_sync::VerifyWarpSyncFragment::verify"><code>VerifyWarpSyncFragment::verify</code></a>.</dd><dt><a class="enum" href="enum.WarpSyncInitError.html" title="enum smoldot::sync::warp_sync::WarpSyncInitError">Warp<wbr>Sync<wbr>Init<wbr>Error</a></dt><dd>Error potentially returned by <a href="fn.start_warp_sync.html" title="fn smoldot::sync::warp_sync::start_warp_sync"><code>start_warp_sync()</code></a>.</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.start_warp_sync.html" title="fn smoldot::sync::warp_sync::start_warp_sync">start_<wbr>warp_<wbr>sync</a></dt><dd>Initializes the warp sync state machine.</dd></dl></section></div></main></body></html>