<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Finalized block header, plus tree of authenticated non-finalized block headers."><title>smoldot::chain::blocks_tree - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-84e720fa.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.89.0 (29483883e 2025-08-04)" data-channel="1.89.0" data-search-js="search-92309212.js" data-settings-js="settings-5514c975.js" ><script src="../../../static.files/storage-4e99c027.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-fd3af306.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../smoldot/index.html">smoldot</a><span class="version">0.19.4</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module blocks_<wbr>tree</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In smoldot::<wbr>chain</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">chain</a></div><h1>Module <span>blocks_tree</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/smoldot/chain/blocks_tree.rs.html#18-690">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Finalized block header, plus tree of authenticated non-finalized block headers.</p>
<p>This module provides the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> type. This type is a data structure
containing a valid tree of block headers, plus the state necessary to verify new blocks with
the intent to add them to that tree. Each block header additionally holds a user-chosen
opaque data.</p>
<p>The state in the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> consists of:</p>
<ul>
<li>One “latest finalized” block and various information about its ancestors, akin to a
<a href="../chain_information/struct.ChainInformation.html" title="struct smoldot::chain::chain_information::ChainInformation"><code>chain_information::ChainInformation</code></a>.</li>
<li>Zero or more blocks that descend from that latest finalized block.</li>
</ul>
<p>The latest finalized block is a block that is guaranteed to never be reverted. While it can
always be set to the genesis block of the chain, it is preferable, in order to reduce
memory utilization, to maintain it to a block that is as high as possible in the chain.</p>
<blockquote>
<p><strong>Note</strong>: While mechanisms such as GrandPa provide a network-wide way to designate a block
as final, the concept of GrandPa-provided finality doesn’t necessarily have to
match the concept of finality in the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a>. For example, an API
user might decide to optimistically assume that the block whose number is
<code>highest_block - 5</code> is automatically finalized, and fall back to rebuilding a new
<a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> if that assumption turns out to not be true. The finalized
block in the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> only represents a block that the
<a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> itself cannot remove, not a block that cannot be removed in
the absolute.</p>
</blockquote>
<p>A block can be added to the chain by calling <a href="struct.NonFinalizedTree.html#method.verify_header" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_header"><code>NonFinalizedTree::verify_header</code></a> then
<a href="struct.NonFinalizedTree.html#method.insert_verified_header" title="method smoldot::chain::blocks_tree::NonFinalizedTree::insert_verified_header"><code>NonFinalizedTree::insert_verified_header</code></a>. As explained in details in
<a href="../../verify/index.html" title="mod smoldot::verify">the <code>verify</code> module</a>, verifying the header only verifies the authenticity of
a block and not its correctness. Additionally verifying the body of the block provides the
strongest guarantee, but is the responsibility of the API user and is out of the scope of
this module.</p>
<blockquote>
<p><strong>Note</strong>: There typically exists two kinds of clients: full and light. Full clients store
the state of the storage, while light clients don’t. For this reason, light
clients can only verify the header of new blocks. Both full and light clients
should wait for a block to be finalized if they want to be certain that it will
forever remain part of the chain.</p>
</blockquote>
<p>Additionally, a <a href="struct.NonFinalizedTree.html#method.verify_justification" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_justification"><code>NonFinalizedTree::verify_justification</code></a> method is provided in order to
verify the correctness of a <a href="../../finality/index.html" title="mod smoldot::finality">justification</a>.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.Config.html" title="struct smoldot::chain::blocks_tree::Config">Config</a></dt><dd>Configuration for the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a>.</dd><dt><a class="struct" href="struct.FinalityApply.html" title="struct smoldot::chain::blocks_tree::FinalityApply">Finality<wbr>Apply</a></dt><dd>Returned by <a href="struct.NonFinalizedTree.html#method.verify_justification" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_justification"><code>NonFinalizedTree::verify_justification</code></a> and
<a href="struct.NonFinalizedTree.html#method.verify_grandpa_commit_message" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_grandpa_commit_message"><code>NonFinalizedTree::verify_grandpa_commit_message</code></a> on success.</dd><dt><a class="struct" href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree">NonFinalized<wbr>Tree</a></dt><dd>Holds state about the current state of the chain for the purpose of verifying headers.</dd><dt><a class="struct" href="struct.RemovedBlock.html" title="struct smoldot::chain::blocks_tree::RemovedBlock">Removed<wbr>Block</a></dt><dd>Block removed from the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> by a <a href="struct.SetFinalizedBlockIter.html" title="struct smoldot::chain::blocks_tree::SetFinalizedBlockIter"><code>SetFinalizedBlockIter</code></a>.</dd><dt><a class="struct" href="struct.SetFinalizedBlockIter.html" title="struct smoldot::chain::blocks_tree::SetFinalizedBlockIter">SetFinalized<wbr>Block<wbr>Iter</a></dt><dd>Iterator producing the newly-finalized blocks removed from the state when the finalized block
is updated.</dd><dt><a class="struct" href="struct.VerifiedHeader.html" title="struct smoldot::chain::blocks_tree::VerifiedHeader">Verified<wbr>Header</a></dt><dd>Successfully-verified block header that can be inserted into the chain.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.CommitVerifyError.html" title="enum smoldot::chain::blocks_tree::CommitVerifyError">Commit<wbr>Verify<wbr>Error</a></dt><dd>Error that can happen when verifying a Grandpa commit.</dd><dt><a class="enum" href="enum.FinalityVerifyError.html" title="enum smoldot::chain::blocks_tree::FinalityVerifyError">Finality<wbr>Verify<wbr>Error</a></dt><dd>Error that can happen when verifying a proof of finality.</dd><dt><a class="enum" href="enum.HeaderVerifyError.html" title="enum smoldot::chain::blocks_tree::HeaderVerifyError">Header<wbr>Verify<wbr>Error</a></dt><dd>Error that can happen when verifying a block header.</dd><dt><a class="enum" href="enum.HeaderVerifySuccess.html" title="enum smoldot::chain::blocks_tree::HeaderVerifySuccess">Header<wbr>Verify<wbr>Success</a></dt><dd>See <a href="struct.NonFinalizedTree.html#method.verify_header" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_header"><code>NonFinalizedTree::verify_header</code></a>.</dd><dt><a class="enum" href="enum.JustificationVerifyError.html" title="enum smoldot::chain::blocks_tree::JustificationVerifyError">Justification<wbr>Verify<wbr>Error</a></dt><dd>Error that can happen when verifying a justification.</dd><dt><a class="enum" href="enum.RemovedBlockType.html" title="enum smoldot::chain::blocks_tree::RemovedBlockType">Removed<wbr>Block<wbr>Type</a></dt><dd>Reason why a block was removed from the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> by a <a href="struct.SetFinalizedBlockIter.html" title="struct smoldot::chain::blocks_tree::SetFinalizedBlockIter"><code>SetFinalizedBlockIter</code></a>.</dd><dt><a class="enum" href="enum.SetFinalizedError.html" title="enum smoldot::chain::blocks_tree::SetFinalizedError">SetFinalized<wbr>Error</a></dt><dd>Error that can happen when setting the finalized block.</dd></dl></section></div></main></body></html>