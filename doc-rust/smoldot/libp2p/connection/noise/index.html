<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Noise protocol libp2p layer."><title>smoldot::libp2p::connection::noise - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.92.0 (ded5c06cf 2025-12-08)" data-channel="1.92.0" data-search-js="search-d69d8955.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../../static.files/main-ce535bd0.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module noise</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../smoldot/index.html">smoldot</a><span class="version">0.21.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module noise</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#protocol-details" title="Protocol details">Protocol details</a></li><li><a href="#usage" title="Usage">Usage</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#constants" title="Constants">Constants</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In smoldot::<wbr>libp2p::<wbr>connection</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../../index.html">smoldot</a>::<wbr><a href="../../index.html">libp2p</a>::<wbr><a href="../index.html">connection</a></div><h1>Module <span>noise</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../src/smoldot/libp2p/connection/noise.rs.html#18-1646">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Noise protocol libp2p layer.</p>
<p>The <a href="https://noiseprotocol.org/">noise protocol</a> is a standard framework for building
cryptographic protocols. Libp2p uses the noise protocol to provide an encryption layer on
top of which data is exchanged.</p>
<h2 id="protocol-details"><a class="doc-anchor" href="#protocol-details">§</a>Protocol details</h2>
<p>Libp2p uses <a href="https://noiseexplorer.com/patterns/XX/">the XX pattern</a>. The handshake consists
of three packets:</p>
<ul>
<li>The initiator generates an ephemeral key pair and sends the public key to the responder.</li>
<li>The responder generates its own ephemeral key pair and sends the public key to the
initiator. Afterwards, the responder derives a shared secret and uses it to encrypt all
further communications. Now encrypted, the responder also sends back its static noise public
key (represented with the <a href="struct.NoiseKey.html" title="struct smoldot::libp2p::connection::noise::NoiseKey"><code>NoiseKey</code></a> type of this module), its libp2p public key, and a
signature of the static noise public key made using its libp2p private key.</li>
<li>The initiator, after having received the ephemeral key from the remote, derives the same
shared secret. It sends its own static noise public key, libp2p public key, and signature.</li>
</ul>
<p>After these three packets, the initiator and responder derive another shared secret using
both the static and ephemeral keys, which is then used to encrypt communications. Note that
the libp2p key isn’t used in the key derivation.</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2>
<p>While this is out of scope of this module, the noise protocol must typically first be
negotiated using the <em>multistream-select</em> protocol. The name of the protocol is given by
the <a href="constant.PROTOCOL_NAME.html" title="constant smoldot::libp2p::connection::noise::PROTOCOL_NAME"><code>PROTOCOL_NAME</code></a> constant.</p>
<p>In order to use noise on top of a connection which has agreed to use noise, create a
<a href="struct.HandshakeInProgress.html" title="struct smoldot::libp2p::connection::noise::HandshakeInProgress"><code>HandshakeInProgress</code></a>, passing a <a href="struct.NoiseKey.html" title="struct smoldot::libp2p::connection::noise::NoiseKey"><code>NoiseKey</code></a>. This <a href="struct.NoiseKey.html" title="struct smoldot::libp2p::connection::noise::NoiseKey"><code>NoiseKey</code></a> is typically generated at
startup and doesn’t need to be persisted after a restart.</p>
<p>Use <a href="struct.HandshakeInProgress.html#method.read_write" title="method smoldot::libp2p::connection::noise::HandshakeInProgress::read_write"><code>HandshakeInProgress::read_write</code></a> when data is received from the wire or when the remote
is ready to receive more data. At every call, a <a href="enum.NoiseHandshake.html" title="enum smoldot::libp2p::connection::noise::NoiseHandshake"><code>NoiseHandshake</code></a> is returned, potentially
indicating the end of the handshake.</p>
<p>If the handshake is finished, a <a href="enum.NoiseHandshake.html#variant.Success" title="variant smoldot::libp2p::connection::noise::NoiseHandshake::Success"><code>NoiseHandshake::Success</code></a> is returned, containing the
<a href="../../peer_id/struct.PeerId.html" title="struct smoldot::libp2p::peer_id::PeerId"><code>PeerId</code></a> of the remote, which is known to be legitimate, and a <a href="struct.Noise.html" title="struct smoldot::libp2p::connection::noise::Noise"><code>Noise</code></a> object through
which all further communications should go through.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.Config.html" title="struct smoldot::libp2p::connection::noise::Config">Config</a></dt><dd>Configuration for a Noise handshake.</dd><dt><a class="struct" href="struct.HandshakeInProgress.html" title="struct smoldot::libp2p::connection::noise::HandshakeInProgress">Handshake<wbr>InProgress</a></dt><dd>Handshake still in progress. More data needs to be sent or received.</dd><dt><a class="struct" href="struct.InnerReadWrite.html" title="struct smoldot::libp2p::connection::noise::InnerReadWrite">Inner<wbr>Read<wbr>Write</a></dt><dd>Stream of decrypted data. See <a href="struct.Noise.html#method.read_write" title="method smoldot::libp2p::connection::noise::Noise::read_write"><code>Noise::read_write</code></a>.</dd><dt><a class="struct" href="struct.Noise.html" title="struct smoldot::libp2p::connection::noise::Noise">Noise</a></dt><dd>State of the noise encryption/decryption cipher.</dd><dt><a class="struct" href="struct.NoiseKey.html" title="struct smoldot::libp2p::connection::noise::NoiseKey">Noise<wbr>Key</a></dt><dd>The noise key is the key exchanged during the noise handshake. It is <strong>not</strong> the same as the
libp2p key. The libp2p key is used only to sign the noise public key, while the ECDH is
performed with the noise key.</dd><dt><a class="struct" href="struct.PayloadDecodeError.html" title="struct smoldot::libp2p::connection::noise::PayloadDecodeError">Payload<wbr>Decode<wbr>Error</a></dt><dd>Error while decoding the handshake.</dd><dt><a class="struct" href="struct.UnsignedNoiseKey.html" title="struct smoldot::libp2p::connection::noise::UnsignedNoiseKey">Unsigned<wbr>Noise<wbr>Key</a></dt><dd>Prototype for a <a href="struct.NoiseKey.html" title="struct smoldot::libp2p::connection::noise::NoiseKey"><code>NoiseKey</code></a>.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.CipherError.html" title="enum smoldot::libp2p::connection::noise::CipherError">Cipher<wbr>Error</a></dt><dd>Error while decoding data.</dd><dt><a class="enum" href="enum.EncryptError.html" title="enum smoldot::libp2p::connection::noise::EncryptError">Encrypt<wbr>Error</a></dt><dd>Error while encrypting data.</dd><dt><a class="enum" href="enum.HandshakeError.html" title="enum smoldot::libp2p::connection::noise::HandshakeError">Handshake<wbr>Error</a></dt><dd>Potential error during the noise handshake.</dd><dt><a class="enum" href="enum.NoiseHandshake.html" title="enum smoldot::libp2p::connection::noise::NoiseHandshake">Noise<wbr>Handshake</a></dt><dd>State of a Noise handshake.</dd></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><dl class="item-table"><dt><a class="constant" href="constant.PROTOCOL_NAME.html" title="constant smoldot::libp2p::connection::noise::PROTOCOL_NAME">PROTOCOL_<wbr>NAME</a></dt><dd>Name of the protocol, typically used when negotiated it using <em>multistream-select</em>.</dd></dl></section></div></main></body></html>