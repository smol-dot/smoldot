<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="General-purpose WebAssembly virtual machine."><title>smoldot::executor::vm - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.92.0 (ded5c06cf 2025-12-08)" data-channel="1.92.0" data-search-js="search-d69d8955.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-ce535bd0.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module vm</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../smoldot/index.html">smoldot</a><span class="version">0.21.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module vm</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#usage" title="Usage">Usage</a></li><li><a href="#about-imported-vs-exported-memory" title="About imported vs exported memory">About imported vs exported memory</a></li><li><a href="#wasm-features" title="Wasm features">Wasm features</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In smoldot::<wbr>executor</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">executor</a></div><h1>Module <span>vm</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/smoldot/executor/vm.rs.html#18-1432">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>General-purpose WebAssembly virtual machine.</p>
<p>Contains code related to running a WebAssembly virtual machine. Contrary to
(<code>HostVm</code>)<a href="../host/enum.HostVm.html" title="enum smoldot::executor::host::HostVm"><code>super::host::HostVm</code></a>, this module isn’t aware of any of the host
functions available to Substrate runtimes. It only contains the code required to run a virtual
machine, with some adjustments explained below.</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2>
<p>Call <a href="struct.VirtualMachinePrototype.html#method.new" title="associated function smoldot::executor::vm::VirtualMachinePrototype::new"><code>VirtualMachinePrototype::new</code></a> in order to parse and/or compile some WebAssembly code.
One of the parameters of this function is a function that is passed the name of functions
imported by the Wasm code, and must return an opaque <code>usize</code>. This <code>usize</code> doesn’t have any
meaning, but will later be passed back to the user through <a href="enum.ExecOutcome.html#variant.Interrupted.field.id" title="field smoldot::executor::vm::ExecOutcome::id"><code>ExecOutcome::Interrupted::id</code></a>
when the corresponding function is called.</p>
<p>Use <a href="struct.VirtualMachinePrototype.html#method.prepare" title="method smoldot::executor::vm::VirtualMachinePrototype::prepare"><code>VirtualMachinePrototype::prepare</code></a> then <a href="struct.Prepare.html#method.start" title="method smoldot::executor::vm::Prepare::start"><code>Prepare::start</code></a> in order to start executing
a function exported through an <code>(export)</code> statement.</p>
<p>Call <a href="struct.VirtualMachine.html#method.run" title="method smoldot::executor::vm::VirtualMachine::run"><code>VirtualMachine::run</code></a> on the <a href="struct.VirtualMachine.html" title="struct smoldot::executor::vm::VirtualMachine"><code>VirtualMachine</code></a> returned by <code>start</code> in order to run the
WebAssembly code. The <code>run</code> method returns either if the function being called returns, or if
the WebAssembly code calls a host function. In the latter case, <a href="enum.ExecOutcome.html#variant.Interrupted" title="variant smoldot::executor::vm::ExecOutcome::Interrupted"><code>ExecOutcome::Interrupted</code></a>
is returned and the virtual machine is now paused. Once the logic of the host function has
been executed, call <code>run</code> again, passing the return value of that host function.</p>
<h2 id="about-imported-vs-exported-memory"><a class="doc-anchor" href="#about-imported-vs-exported-memory">§</a>About imported vs exported memory</h2>
<p>WebAssembly supports, in theory, addressing multiple different memory objects. The WebAssembly
module can declare memory in two ways:</p>
<ul>
<li>Either by exporting a memory object in the <code>(export)</code> section under the name <code>memory</code>.</li>
<li>Or by importing a memory object in its <code>(import)</code> section.</li>
</ul>
<p>The virtual machine in this module supports both variants. However, no more than one memory
object can be exported or imported, and it is illegal to not use any memory.</p>
<p>The first variant used to be the default model when compiling to WebAssembly, but the second
variant (importing memory objects) is preferred nowadays.</p>
<h2 id="wasm-features"><a class="doc-anchor" href="#wasm-features">§</a>Wasm features</h2>
<p>The WebAssembly specification is a moving one. The specification as it was when it launched
in 2017 is commonly referred to as “the MVP” (minimum viable product). Since then, various
extensions have been added to the WebAssembly format.</p>
<p>The code in this module, however, doesn’t allow any of the feature that were added post-MVP.
Trying to use WebAssembly code that uses one of these features will result in an error.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.Config.html" title="struct smoldot::executor::vm::Config">Config</a></dt><dd>Configuration to pass to <a href="struct.VirtualMachinePrototype.html#method.new" title="associated function smoldot::executor::vm::VirtualMachinePrototype::new"><code>VirtualMachinePrototype::new</code></a>.</dd><dt><a class="struct" href="struct.HeapPages.html" title="struct smoldot::executor::vm::HeapPages">Heap<wbr>Pages</a></dt><dd>Number of heap pages available to the Wasm code.</dd><dt><a class="struct" href="struct.OutOfBoundsError.html" title="struct smoldot::executor::vm::OutOfBoundsError">OutOf<wbr>Bounds<wbr>Error</a></dt><dd>Error while reading memory.</dd><dt><a class="struct" href="struct.Prepare.html" title="struct smoldot::executor::vm::Prepare">Prepare</a></dt><dt><a class="struct" href="struct.Signature.html" title="struct smoldot::executor::vm::Signature">Signature</a></dt><dd>Low-level Wasm function signature.</dd><dt><a class="struct" href="struct.Trap.html" title="struct smoldot::executor::vm::Trap">Trap</a></dt><dd>Opaque error that happened during execution, such as an <code>unreachable</code> instruction.</dd><dt><a class="struct" href="struct.UnsupportedTypeError.html" title="struct smoldot::executor::vm::UnsupportedTypeError">Unsupported<wbr>Type<wbr>Error</a></dt><dd>Error used in the conversions between VM implementation and the public API.</dd><dt><a class="struct" href="struct.VirtualMachine.html" title="struct smoldot::executor::vm::VirtualMachine">Virtual<wbr>Machine</a></dt><dt><a class="struct" href="struct.VirtualMachinePrototype.html" title="struct smoldot::executor::vm::VirtualMachinePrototype">Virtual<wbr>Machine<wbr>Prototype</a></dt><dd>Virtual machine ready to start executing a function.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.ExecHint.html" title="enum smoldot::executor::vm::ExecHint">Exec<wbr>Hint</a></dt><dd>Hint used by the implementation to decide which kind of virtual machine to use.</dd><dt><a class="enum" href="enum.ExecOutcome.html" title="enum smoldot::executor::vm::ExecOutcome">Exec<wbr>Outcome</a></dt><dd>Outcome of the <a href="struct.VirtualMachine.html#method.run" title="method smoldot::executor::vm::VirtualMachine::run"><code>run</code></a> function.</dd><dt><a class="enum" href="enum.GlobalValueErr.html" title="enum smoldot::executor::vm::GlobalValueErr">Global<wbr>Value<wbr>Err</a></dt><dd>Error that can happen when calling <a href="struct.VirtualMachinePrototype.html#method.global_value" title="method smoldot::executor::vm::VirtualMachinePrototype::global_value"><code>VirtualMachinePrototype::global_value</code></a>.</dd><dt><a class="enum" href="enum.NewErr.html" title="enum smoldot::executor::vm::NewErr">NewErr</a></dt><dd>Error that can happen when initializing a <a href="struct.VirtualMachinePrototype.html" title="struct smoldot::executor::vm::VirtualMachinePrototype"><code>VirtualMachinePrototype</code></a>.</dd><dt><a class="enum" href="enum.RunErr.html" title="enum smoldot::executor::vm::RunErr">RunErr</a></dt><dd>Error that can happen when resuming the execution of a function.</dd><dt><a class="enum" href="enum.StartErr.html" title="enum smoldot::executor::vm::StartErr">Start<wbr>Err</a></dt><dd>Error that can happen when calling <a href="struct.Prepare.html#method.start" title="method smoldot::executor::vm::Prepare::start"><code>Prepare::start</code></a>.</dd><dt><a class="enum" href="enum.ValueType.html" title="enum smoldot::executor::vm::ValueType">Value<wbr>Type</a></dt><dd>Type of a value passed as parameter or returned by a function.</dd><dt><a class="enum" href="enum.WasmValue.html" title="enum smoldot::executor::vm::WasmValue">Wasm<wbr>Value</a></dt><dd>Value that a Wasm function can accept or produce.</dd></dl></section></div></main></body></html>